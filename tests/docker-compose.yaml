services:
  # kafka-dev:
  #   image: apache/kafka:4.1.1
  #   container_name: kafka-dev
  #   ports: 
  #     # 映射 9092 端口到 Host
  #     - "9092:9092"
  #   environment:
  #     KAFKA_NODE_ID: 1
  #     KAFKA_PROCESS_ROLES: broker,controller
  #     KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
  #     # docker外部访问使用主机名 kafka-dev, 记得改hosts
  #     KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-dev:9092 
  #     KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
  #     KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
  #     KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-dev:9093
  #     KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
  #     KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
  #     KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
  #     KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
  #     KAFKA_NUM_PARTITIONS: 1
  #   extra_hosts:
  #     - "kafka-dev:127.0.0.1"
  #   volumes:
  #     # 持久化 KRaft 模式下的数据
  #     - kafka_kraft_data:/tmp/kraft-storage
  
  # kafka-init-topics:
  #   image: apache/kafka:4.1.1 # 使用相同的 Kafka 镜像
  #   container_name: kafka-init-topics
  #   depends_on:
  #     kafka-dev:
  #       condition: service_started
  #   command: |
  #     /bin/sh -c "
  #     echo 'Waiting for kafka-dev to start...' && \
  #     sleep 5 && \
  #     /opt/kafka/bin/kafka-topics.sh --create --if-not-exists --bootstrap-server kafka-dev:9092 --topic order_events --partitions 1 --replication-factor 1 && \
  #     /opt/kafka/bin/kafka-topics.sh --create --if-not-exists --bootstrap-server kafka-dev:9092 --topic ledger_events --partitions 1 --replication-factor 1 && \
  #     echo 'Kafka topics initialized successfully.'
  #     "
  #   restart: "no"
  
  redis:
    image: redis:8.4-alpine3.22
    container_name: redis
    ports:
      - "6379:6379"

  # mysql-dev:
  #   image: mysql:8.0.44
  #   container_name: mysql-dev
  #   restart: always
  #   environment:
  #     MYSQL_ROOT_PASSWORD: rootpassword
  #     MYSQL_DATABASE: tex
  #     MYSQL_USER: tex
  #     MYSQL_PASSWORD: n8btp3yfl0arxb12
  #   command:
  #     [
  #       # "--default-authentication-plugin=mysql_native_password",
  #       "--character-set-server=utf8mb4",
  #       "--collation-server=utf8mb4_0900_ai_ci",
  #       "--max_connections=200",
  #       "--skip-name-resolve"
  #     ]
  #   healthcheck:
  #     test: ["CMD-SHELL", "mysqladmin ping -h 127.0.0.1 -uroot -prootpassword"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #   ports:
  #     - "3306:3306"
  #   volumes:
  #     - ./init:/docker-entrypoint-initdb.d  # 可选，加载你的 schema.sql

volumes:
  kafka_kraft_data: